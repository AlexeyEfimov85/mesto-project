(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Z:()=>E});var t=document.querySelector("#form-profile"),o=(document.querySelector("#form-profile"),document.querySelector("#popup-place")),n=document.querySelector("#popup-edit-profile"),r=document.querySelector(".profile__button-create"),c=document.querySelector(".popup__toggle_create-new-card"),a=document.querySelector("#form-place"),i=document.querySelector(".profile__button-edit"),u=n.querySelector(".popup__toggle"),s=document.querySelector("#popup-place-full"),l=s.querySelector(".popup__toggle"),d=document.forms.formProfile.querySelector("#form__item-username"),f=document.forms.formProfile.querySelector("#form__item-userjob"),_=document.querySelector(".profile__title"),p=document.querySelector(".profile__description"),m=document.querySelector(".profile__avatar-container"),v=document.querySelector("#popup-profile-foto"),h=document.querySelector(".popup__toggle_profile-foto"),y=document.querySelector("#form__item-avatarlink"),S=document.querySelector("#form-profile-foto");function q(e){e.classList.add("popup_opened"),document.addEventListener("keydown",L)}function b(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",L)}var L=function(e){"Escape"===e.key&&b(document.querySelector(".popup_opened"))};function g(e){var t=document.querySelectorAll(".form__button_text_default"),o=document.querySelectorAll(".form__button_text_loading");e?(t.forEach((function(e){e.classList.add("form__button_text_invisible")})),o.forEach((function(e){e.classList.remove("form__button_text_invisible"),e.classList.add("form__button_text_visible")}))):(t.forEach((function(e){e.classList.add("form__button_text_visible"),e.classList.remove("form__button_text_invisible")})),o.forEach((function(e){e.classList.add("form__button_text_invisible"),e.classList.remove("form__button_text_visible")})))}function k(){return fetch("https://nomoreparties.co/v1/plus-cohort-26/users/me",{headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__avatar").src=e.avatar,e})).catch((function(e){console.log(e)}))}var E,j=document.querySelector("#popup-place-full"),C=j.querySelector("#card-image"),x=j.querySelector(".popup__image-title"),P=document.querySelector("#form__item-placetitle"),T=document.querySelector("#form__item-placelink"),O=document.querySelector(".places"),z=function(e,t,o,n,r,c){var a=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__trash");return a.querySelector(".card__image").src=t,a.querySelector(".card__title").textContent=e,a.querySelector(".card__image").alt=e,a.querySelector(".card__like-sum").textContent=o,n===E&&i.classList.add("card__trash_visible"),c&&a.querySelector(".card__button").classList.add("card__button_checked"),a.querySelector(".card__button").addEventListener("click",(function(e){e.target.classList.contains("card__button_checked")?function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-26/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a","Content-Type":"application/json"},body:JSON.stringify()}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(r).then((function(t){e.target.classList.remove("card__button_checked"),a.querySelector(".card__like-sum").textContent=t.likes.length})):function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-26/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a","Content-Type":"application/json"},body:JSON.stringify()}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(r).then((function(t){e.target.classList.add("card__button_checked"),a.querySelector(".card__like-sum").textContent=t.likes.length}))})),i.addEventListener("click",(function(e){e.target.closest(".card").remove(),function(e){fetch("https://nomoreparties.co/v1/plus-cohort-26/cards/".concat(e),{method:"DELETE",headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a","Content-Type":"application/json"},body:JSON.stringify()}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(r)})),a.querySelector(".card__image").addEventListener("click",(function(e){q(j),C.src=e.target.src,x.textContent=e.target.alt,C.alt=e.target.alt})),a},A=".form",N=".form__item",w=".form__button",J="form__button_inactive",D="form__item_type_error",M="form__item-username-error_active",H=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(J)):(t.disabled=!0,t.classList.add(J))};k().then((function(e){E=e._id})).catch((function(e){console.log(e)})),l.addEventListener("click",(function(){b(s)})),s.addEventListener("click",(function(e){e.target.classList.contains("popup")&&b(s)})),r.addEventListener("click",(function(){q(o)})),c.addEventListener("click",(function(){b(o)})),o.addEventListener("click",(function(e){e.target.classList.contains("popup")&&b(o)})),i.addEventListener("click",(function(){q(n),d.value=document.querySelector(".profile__title").textContent,f.value=document.querySelector(".profile__description").textContent})),u.addEventListener("click",(function(){b(n)})),n.addEventListener("click",(function(e){e.target.classList.contains("popup")&&b(n)})),m.addEventListener("click",(function(){q(v)})),v.addEventListener("click",(function(e){e.target.classList.contains("popup")&&b(v)})),h.addEventListener("click",(function(){b(v)})),t.addEventListener("submit",(function(e){var t;e.preventDefault(),g(!0),t={name:d.value,about:f.value},fetch("https://nomoreparties.co/v1/plus-cohort-26/users/me",{method:"PATCH",headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a","Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about,document.querySelector(".profile__avatar").src=e.avatar})).catch((function(e){console.log(e)})),k().then((function(){b(n),d.value=_.textContent,f.value=p.textContent})).finally((function(){g(!1)}))})),a.addEventListener("submit",(function(e){var t;e.preventDefault(),g(!0),(t={name:P.value,link:T.value},fetch("https://nomoreparties.co/v1/plus-cohort-26/cards",{method:"POST",headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a","Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){O.prepend(z(e.name,e.link,e.likes.length,e.owner._id,e._id))})).catch((function(e){console.log(e)}))).then((function(){var e;b(o),(e=document.forms.form.querySelector(w)).disabled=!0,e.classList.add(J),P.value="",T.value=""})).finally((function(){g(!1)}))})),S.addEventListener("submit",(function(e){var t;e.preventDefault(),g(!0),(t={avatar:y.value},fetch("https://nomoreparties.co/v1/plus-cohort-26/users/me/avatar",{method:"PATCH",headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a","Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){document.querySelector(".profile__avatar").src=e.avatar}))).then((function(){b(v),y.value=""})).finally((function(){g(!1)}))})),Array.from(document.querySelectorAll(A)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(N)),o=e.querySelector(w);H(t,o),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(D),o.classList.remove(M),o.textContent=""}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(D),n.textContent=o,n.classList.add(M)}(e,t,t.validationMessage)})(e,n),H(t,o)}))}))}(e)})),fetch("https://nomoreparties.co/v1/plus-cohort-26/cards",{headers:{authorization:"dff808ff-3720-4dec-bd88-6c3aa62f954a"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=e.likes.map((function(e){return e._id})).some((function(e){return e===E}));O.append(z(e.name,e.link,e.likes.length,e.owner._id,e._id,t))}))})).catch((function(e){console.log(e)}))})();